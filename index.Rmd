---
title: "TAMPA BAY ECONOMIC VALUATION DASHBOARD"
output: 
  flexdashboard::flex_dashboard:
     logo: img/tarponlogo.png
     social: menu
     source_code: "https://github.com/tbep-tech/tbev-dash"
runtime: shiny
css: styles.css
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, message = F, warning = F)

# libraries
library(flexdashboard)
library(shiny)
library(dplyr)
library(sf)
library(mapview)
library(leaflet)
library(RColorBrewer)
library(plotly)
library(leafpop)
library(gridExtra)
library(leafsync)

load(file = "data/shoreline.RData")
load(file = "data/watershed.RData")
load(file = "data/habitats.RData")
load(file = "data/wetlands.RData")
load(file = "data/mangroves.RData")
load(file = "data/parcels.RData")

EI_sector <- read.csv("data/EI_sector.csv")
EI_industry <- read.csv("data/EI_industry.csv")
EI_contribution <- read.csv("data/EI_contribution.csv")
PV_values <- read.csv("data/PV_values.csv")
ES_carbon <- read.csv("data/ES_carbon.csv")
ES_denitrification <- read.csv("data/ES_denitrification.csv")
ES_flood <- read.csv("data/ES_flood.csv")


downloadButtonRmd <- function (outputId, label = "Download", class = NULL, ...)  {
  tags$a(id = outputId, class = paste("btn btn-default shiny-download-link", 
                                      class), href = "", target = "_blank", download = NA, 
         icon("download"), label, ...)
}

tbepcols10 <- c("#00806E","#004F7E","#5C4A42","#958984","#D69C4E","#962D14","#352849","#9C974A","#78B7C5","#D8A499","#427355","#D67336","#7394D4","#F2AD00","#C93211","#E6A0C4","#090909")

```


```{r reactives}
allsectors_pie <- reactive({
  # inputs
  impact_selection <- input$impact_selection
  contribution_selection <- input$contribution_selection
  # filter and format input data
  mydata <- EI_sector %>% 
    filter(Contribution %in% contribution_selection) %>% 
    rename(imp = !!impact_selection) %>% 
    mutate(
      lab = case_when(
        impact_selection == 'Employment' ~ paste(prettyNum(round(imp, digits = 0), big.mark = ","), "jobs"), 
        T ~ paste("$", prettyNum(round(imp, digits = 0), big.mark = ","))))
  # make the pie chart
  out <- mydata %>% 
    plot_ly(width = 800, height = 350,
    labels = ~Sector,
    values = ~imp,
    type = "pie",
    sort = FALSE,
    direction = "clockwise",
    marker = list(colors = tbepcols10),
    textinfo = "percent",
    insidetextfont = list(color = '#FFFFFF'),
    hoverinfo = "text",
    text = ~lab) %>%
  layout(
    legend = list(
      title = list(text = "<b>Sectors</b>", side = "top"),
      orientation = "v"),
    hoverlabel = list(
      font = list(family = "Arial", size = 16, color = "white")))
  return(out)
}) 


sector_pie <- reactive({
  # inputs
  impact_sector_selection <- input$impact_sector_selection
  attribute_selection <- input$attribute_selection
  sector_selection <- input$sector_selection
  
  # filter and format input data
  if(attribute_selection == "Contribution"){
  mydata <- EI_sector %>% 
    filter(Sector == sector_selection & Contribution != "Total") %>% 
    rename(imp = !!impact_sector_selection,
           attribute = Contribution) %>% 
    mutate(
      lab = case_when(
        impact_sector_selection == 'Employment' ~ paste(prettyNum(round(imp, digits = 0), big.mark = ","), "jobs"), 
        T ~ paste("$", prettyNum(round(imp, digits = 0), big.mark = ","))))
      legendtitle <- "<b>Contribution</b>"
}
  
    if(attribute_selection == "Industry"){
  mydata <- EI_industry %>% 
    filter(Sector == sector_selection) %>% 
    rename(imp = !!impact_sector_selection,
           attribute = Industry) %>% 
    mutate(
      lab = case_when(
        impact_sector_selection == 'Employment' ~ paste(prettyNum(round(imp, digits = 0), big.mark = ","), "jobs"), 
        T ~ paste("$", prettyNum(round(imp, digits = 0), big.mark = ","))))
    legendtitle <- "<b>Industry</b>"
  }
  
  
  # make the pie chart
  out <- mydata %>% 
    plot_ly(width = 800, height = 350,
    labels = ~attribute,
    values = ~imp,
    type = "pie",
    sort = FALSE,
    direction = "clockwise",
    marker = list(colors = tbepcols10),
    textinfo = "percent",
    insidetextfont = list(color = '#FFFFFF'),
    hoverinfo = "text",
    text = ~lab) %>%
  layout(
    legend = list(
      title = list(text = legendtitle, side = "top"),
      orientation = "v"),
    hoverlabel = list(
      font = list(family = "Arial", size = 16, color = "white")))
  return(out)
}) 























habitat_map <- reactive({
  
  # inputs
  habitat_selection <- input$habitat_selection

  # filter and format input data
  mydata <- habitats %>% 
    filter(Habitat %in% habitat_selection)

  cols <- c("#004F7E","#9C974A","#962D14","#5C4A42","#78B7C5","#00806E","#F2AD00")
  names(cols) <- c("Freshwater Wetlands","Mangrove Forests", "Oyster Bars", "Pine Flatwoods",   
                 "Salt Marshes", "Seagrasses","Shrub and Brushland")
  color_selection <- cols[[habitat_selection]]

  # make the map
  out <- mydata %>% 
    select(Habitat, Area, Sequestration, Denitrification) %>% 
    mapview(zcol = "Habitat", 
            col.regions = color_selection, 
            alpha.regions = 1.0,
            lwd = 0, 
            layer.name = "Habitat", 
            popup = popupTable(habitats, zcol = c("Habitat","Area","Sequestration","Denitrification"), 
                               feature.id = FALSE, row.numbers = FALSE)) %>% 
    .@map
  
  return(out)
})


```


```{r downloadhandlers}
# all data
output$TBEVdata <- downloadHandler(
  filename = function(){paste("AllDatasets","zip", sep=".")},
  content = function(file){
    file.copy("reportdata/AllDatasets.zip", file)},
  contentType = "application/zip")

# economic impact data
output$EIdata <- downloadHandler(
  filename = function(){paste("EconomicImpacts","zip", sep=".")},
  content = function(file){
    file.copy("reportdata/EconomicImpacts.zip", file)},
  contentType = "application/zip")

# property value data
output$PVdata <- downloadHandler(
  filename = function(){paste("PropertyValues","zip", sep=".")},
  content = function(file){
    file.copy("reportdata/PropertyValues.zip", file)},
  contentType = "application/zip")

# ecosystem service data
output$ESdata <- downloadHandler(
  filename = function(){paste("EcosystemServices","zip", sep=".")},
  content = function(file){
    file.copy("reportdata/EcosystemServices.zip", file)},
  contentType = "application/zip")

```


Overview
===========================================================

Column {data-width=700}
-----------------------------------------------------------------------

<div class = "row">
<div class = "col-md-2"></div>
<div class = "col-md-10">

#### The Economic Valuation of Tampa Bay

Tampa Bay is a 400-square-mile estuary situated along the west coast of Florida in the second-most populous region in the state. Tampa Bay is an estuary of national significance and is of vital importance to the surrounding region's economy. The natural resources of Tampa Bay support essential industries such as tourism, mineral extraction, marine transportation, and other commercial and recreational activities. Additionally, the Tampa Bay watershed is comprised of rich and diverse habitats that provide ecosystem services and community benefits that enhance the quality of life.

The purpose of the Economic Valuation of Tampa Bay is to provide an economic valuation of the natural resources in Tampa Bay and its watershed. The results demonstrate the Tampa Bay estuary’s value in providing substantial economic, social, and environmental benefits to the region’s industries, residents, and visitors. Moreover, the methodologies established herein provide a replicable process for performing a valuation of Tampa Bay.
<br>
 
```{r, fig.align='center', out.width='5%'}
knitr::include_graphics('img/spacer.PNG')
```

#### Using the dashboard

Explore the methods and results of the study through the different pages of this dashboard. Tampa Bay’s value is illustrated in three different ways:

1) [__Economic Impacts of Industry Sectors__](#economic-impacts-of-industry-sectors). This page summarizes the annual economic impacts, including output, jobs, and wages, generated by bay-dependent industries on the economy.
1) [__Property Value Amenity Impacts__](#property-value-amenity-impacts). This page examines the effects of bay proximity on property value premiums for single-family homes within a quarter mile of the water. 
1) [__Ecosystem Services__](#ecosystem-services). This page highlights the value of ecosystem services (carbon sequestration, denitrification, and flood protection) provided by habitats across Tampa Bay, such as mangrove forests, saltwater marshes, and freshwater wetlands. 

Methodological summaries for each of these three analyses can be found in the Methods pages. For more detailed information regarding data sources, calculations, modelling, and results, consult the full 2023 Economic Valuation of Tampa Bay report, which can be downloaded using the link on the right side of this page.
<br>
 
```{r, fig.align='center', out.width='5%'}
knitr::include_graphics('img/spacer.PNG')
```

<a rel='license' href='http://creativecommons.org/licenses/by/4.0/'><img alt='Creative Commons License' style='border-width:0' src='https://i.creativecommons.org/l/by/4.0/88x31.png' /></a>&nbsp;&nbsp;This website is licensed under a <a rel='license' href='http://creativecommons.org/licenses/by/4.0/'>Creative Commons Attribution 4.0 International License</a>.

</div>
<div class = "col-md-2"></div>
</div>


Column {data-width=325}
-----------------------------------------------------------------------

<div class = "row">
<div class = "col-md-2"></div>
<div class = "col-md-9">

<br>
```{r, fig.align='left', out.width='80%'}
knitr::include_graphics('img/report.PNG')
```

<b>[Download the full report](https://github.com/tbep-tech/tbev-dash)</b>

```{r, fig.align='center', out.width='5%'}
knitr::include_graphics('img/spacer.PNG')
```


#### More information

<font size="3">Questions and comments about the dashboard can be sent to [Dr. Blake Simmons](mailto:bsimmons@tbep.org). The website source content can be viewed on [Github](https://github.com/tbep-tech/tbev-dash). Like this app? Share it on social media using the [\#TampaBayOpenSci](https://twitter.com/hashtag/TampaBayOpenSci?src=hashtag_click) hashtag. 

Questions and comments about the study can be sent to the lead author of the report, [Alana Todd](mailto:alana@tbrpc.org). Any use or reference to the information displayed in the dashboard should cite the original report.

<i>This study was funded in part by the Tampa Bay Estuary Program's Environmental Restoration Fund.</i></font> 

```{r, fig.align='left', out.width='80%'}
knitr::include_graphics('img/tbrpclogo.PNG')
```

```{r, fig.align='left', out.width='80%'}
knitr::include_graphics('img/tbeptberflogo.PNG')
```

</div>
<div class = "col-md-2"></div>
</div>


Economic Impacts of Industry Sectors {data-navmenu="Results"}
===========================================================

Column {.tabset .tabset-fade data-width=275}
-----------------------------------------------------------------------

### ABOUT

<font size="3">

The economic impact analysis performed for this report estimates the economic contributions of estuary-dependent industries to the regional economy. 

To capture the full impact of a region’s economy, this study includes <span style="color:#00806E">direct</span> effects (employment and spending), <span style="color:#00806E">indirect</span> effects (supply-chain-related spending), <span style="color:#00806E">induced</span> effects (household spending), and the combined <span style="color:#00806E">total</span> effects for Tampa Bay's economy.

Monetary transactions (i.e., cash flows) between industries have been converted to three different measures of economic impact: (1) <span style="color:#00806E">output</span> represents the total annual production value of an industry; (2) <span style="color:#00806E">employment</span> captures the number of full-time, part-time, and seasonal jobs; (3) <span style="color:#00806E">personal income</span> represents all forms of employment income, including wages, benefits, and proprietor income.

Businesses are grouped into <span style="color:#00806E">industries</span> based on definitions from the U.S. Bureau of Economic Analysis. Bay-dependent industry <span style="color:#00806E">sectors</span> comprise industries of businesses directly contingent on natural resources from Tampa Bay and its watershed.
</font>

<font size="4"><b>Results Summary</b></font>

<font size="3">
Overall, bay-dependent industry sectors directly support <span style="color:#00806E">142,820</span> employees and almost <span style="color:#00806E">\$7.1 billion</span> in personal income annually. All bay-dependent sectors account for <span style="color:#00806E">\$20.8 billion</span> in direct output or <span style="color:#00806E">6.6%</span> of the Tampa Bay watershed’s annual economic output.  

Combining direct, indirect, and induced impacts from Tampa Bay-dependent industries resulted in <span style="color:#00806E">207,068</span> employees, <span style="color:#00806E">\$10.4 billion</span> in personal income, and <span style="color:#00806E">\$32.1 billion</span> in total output. This means about one in ten total jobs are bay-related, and about <span style="color:#00806E">10.8%</span> of the watershed’s total output is bay-related.
</font>



### USING THIS PAGE

<font size="3">

This page provides breakdowns of economic impacts by sector and industry. Users can explore the economic impacts for each sector (or all sectors) using the tabs on the right.

When exploring <span style="color:#00806E">All Sectors</span> combined, select the desired measure of economic impact to display (output, employment, or income) and the type of contribution (total, direct, indirect, or induced) to see how each sector contributes to the total economic impact of Tampa Bay.

When exploring <span style="color:#00806E">Individual Sectors</span>, select the sector of interest, the measure of economic impact to display, and distinguish by type of contribution or the direct contributions of each industry. 

The charts in each tab are interactive and automatically adapt to the dropdown selections. The charts display the percent of the sector's economic impacts attributed to each industry or type of contribution. Hovering over the chart will display the absolute impact (in dollars or jobs) of the corresponding industry or type of contribution.

<i>NOTE: Economic impacts of some sectors are entirely represented by a single industry. Although there are more industries comprising those sectors, they are not directly contingent on Tampa Bay's natural resources and thus are not shown in the legend.</i>

</font>




Column {.tabset .tabset-fade data-width=650}
-----------------------------------------------------------------------

#### Economic Impacts of Industry Sectors


### All Sectors

```{r}
mainPanel(
  column(6,
         selectInput('impact_selection', 'Select economic impact:', selected = "Output", choices = list("Output" = "Output", "Employment" = "Employment","Income" = "Personal.Income"))),
  column(6,
         selectInput('contribution_selection', 'Select contribution:', selected = "Total", choices = c("Total", "Direct","Indirect","Induced"))))
```
<br>
<br>

```{r}
output$allsectors_pie <- renderPlotly(allsectors_pie())
plotlyOutput("allsectors_pie")
```

### Individual Sectors

```{r}
column(12,
  column(4,
         selectInput('sector_selection', 'Select sector:', selected = "Marine Construction", choices = unique(EI_sector$Sector))),
  column(4,
         selectInput('impact_sector_selection', 'Select economic impact:', selected = "Output", choices = list("Output" = "Output", "Employment" = "Employment","Income" = "Personal.Income"))),
  column(4,
           selectInput('attribute_selection', 'Select attribute:', selected = "Direct Industry Breakdown", choices = c("Direct Industry Breakdown" = "Industry", "Type of Contribution" = "Contribution"))))
```
<br>
<br>

```{r}
output$sector_pie <- renderPlotly(sector_pie())
plotlyOutput("sector_pie")
```




Property Value Amenity Impacts {data-navmenu="Results"}
===========================================================


Column {.tabset .tabset-fade data-width=275}
-----------------------------------------------------------------------

### ABOUT

<font size="3">

Proximity to valued amenities, such as waterfront views, generates price premiums for adjacent properties, just as the value of a home rises with the number of bedrooms or total floor space. For this analysis, hedonic pricing was used to value amenities provided by Tampa Bay to nearby properties. It uses statistical methods to parse the relative contribution of an amenity to the total value of an asset by isolating the effect of different elements of a property’s market value.

This report examined property appraiser data for 61,287 single-family homes within the watershed boundaries (10,484 of which had been sold within the last two years) to estimate the added amenity value afforded by the bay to nearby properties (those within a quarter-mile of the shoreline).

Two measures of property values were considered: <span style="color:#00806E">sale price</span> and <span style="color:#00806E">justified value</span>. In contrast to the sale price, the justified value is the value a property appraiser assigns to a parcel, which offers a more conservative lower bound for impacts on property values given its robustness to changing market conditions.
</font>

<font size="4"><b>Results Summary</b></font>

<font size="3">
The model with the strongest explanatory power was a regression on the justified value. This model found that for a comparable parcel, being within a quarter-mile of the water added about <span style="color:#00806E">\$52,769</span> to its justified value. Multiplying this added value by the number of single-family parcels within a quarter mile gives a total added value of <span style="color:#00806E">\$3.23 billion</span>.
</font>


### USING THIS PAGE

<font size="3">

This page summarizes the results of the two best models quantifying the added benefit of bay-proximity to the sale price and justified value of homes in Tampa Bay.

The <span style="color:#00806E">Area of Benefit</span> tab provides a map showing the quarter-mile shoreline buffer used to distinguish properties close to the coast from those far from the coast. The total estimated value added by bay-proximity is representative of all homes within this shoreline boundary, relative to all homes outside of that boundary.

The <span style="color:#00806E">Property Benefits</span> tab provides a comparison of the results for properties' sale price and justified value. It highlights differences in (1) the number of properties near the coast that are included in the model, (2) the added amenity value per property, and (3) the total value added to all single-family properties near the coast.

<i>NOTE: Although impacts to both sale price and justified value are featured in this dashboard, the authors recommend placing greater emphasis on the justified value results given the limitations inherent in the sale price model. See the full report for more detail. </i>

</font>


Column {.tabset .tabset-fade data-width=650}
-----------------------------------------------------------------------

#### Property Value Amenity Impacts

### Area of Benefit (DONE)

```{r}

#mapview(watershed, color = "black", lwd = 2, legend = FALSE, label = "Name", popup = FALSE) +
#  mapview(shoreline, col.regions = "#00806E", layer.name = "Shoreline (0.25 mile buffer)", label = FALSE, popup = FALSE)
```

### Property Benefits (DONE)

<br>
```{r}

PropertyValues1 <- PV_values %>%
  plot_ly(
    width = 900,
    height = 410,
    x = ~Indicator,
    y = ~Number.of.properties,
    type = "bar",
    marker = list(color = c("#00806E","#004F7E")),
    hoverinfo = "text",
    text = ~Properties) %>%
  layout(
      #title = "Properties Included in Model",
      yaxis = list(title = "Number of properties close to coast"),
      xaxis = list(title = ""),
      hoverlabel = list(
        font = list(family = "Arial", size = 16, color = "white")))

PropertyValues2 <- PV_values %>%
  plot_ly(
    width = 900,
    height = 410,
    x = ~Indicator,
    y = ~Value.added.to.each.nearby.home,
    type = "bar",
    marker = list(color = c("#00806E","#004F7E")),
    hoverinfo = "text",
    text = ~Value) %>%
  layout(
    #title = "Benefit per Property",
    yaxis = list(title = "Value added to each home ($)", tick0 = 0, dtick = 20000),
    xaxis = list(title = ""),
    hoverlabel = list(
      font = list(family = "Arial", size = 16, color = "white")))

PropertyValues3 <- PV_values %>%
  plot_ly(
    width = 900,
    height = 410,
    x = ~Indicator,
    y = ~Added.regional.value..billion.,
    type = "bar",
    marker = list(color = c("#00806E","#004F7E")),
    hoverinfo = "text",
    text = ~Benefit) %>%
  layout(
    #title = "Total Regional Benefit",
    yaxis = list(title = "Value to all homes near coast ($ billion)"),
    xaxis = list(title = ""),
    hoverlabel = list(
      font = list(family = "Arial", size = 16, color = "white")))

PropertyValues <- subplot(PropertyValues1, PropertyValues2, PropertyValues3, nrows = 1,
                          titleY = TRUE, titleX = FALSE, margin = 0.06) %>%
  layout(showlegend = FALSE,
         annotations = list(
           list(x = 0.05, y = 1.09, text = "Properties Included", showarrow = F, xref='paper', yref='paper', font = list(size = 16)),
           list(x = 0.5, y = 1.09, text = "Benefit per Property", showarrow = F, xref='paper', yref='paper', font = list(size = 16)),
           list(x = 0.98, y = 1.09, text = "Total Regional Benefit", showarrow = F, xref='paper', yref='paper', font = list(size = 16))))
PropertyValues
```



Ecosystem Services {data-navmenu="Results"}
===========================================================

Column {.tabset .tabset-fade data-width=275}
-----------------------------------------------------------------------

### ABOUT

<font size="3">

This study quantifies values associated with <span style="color:#00806E">carbon sequestration</span>, <span style="color:#00806E">flood protection</span>, and <span style="color:#00806E">denitrification</span> services provided by relevant habitats around the Tampa Bay estuary. The results are simplified estimates designed to raise awareness of the benefits afforded by ecosystem services and a prelude to future analyses and planning using more complete information and site-specific data. 

The services provided by ecosystems have not traditionally been incorporated into valuations, effectively assigning them an implicit value of zero. Revealed preference methods were used in this study to value three regulating services: flood protection, water purification via denitrification, and climate regulation via carbon sequestration.

</font>

<font size="4"><b>Results Summary</b></font>

<font size="3">
Each year, habitats in the Tampa Bay watershed sequester approx. <span style="color:#00806E">595,719 metric tons of CO2</span> valued at <span style="color:#00806E">\$52.29 million</span>. Additionally, there is approx. <span style="color:#00806E">60.73 million metric tons of CO2</span> currently stored in the vegetation and soil of these habitats from previous years. If these habitats were lost, their emissions would be equivalent to <span style="color:#00806E">\$53 billion</span> in costs imposed on society.

Each year, mangrove forests provide approx. <span style="color:#00806E">\$6.18 million</span>, salt marshes provide <span style="color:#00806E">\$0.6 million</span>, seagrass meadows provide <span style="color:#00806E">\$121 million</span>, and freshwater wetlands provide <span style="color:#00806E">\$579 million</span> in nitrogen removal services across the watershed. Together, these habitats remove more than <span style="color:#00806E">7.3 million kilograms of nitrogen</span> each year, providing approx. <span style="color:#00806E">\$715 million</span> worth of denitrification benefits that directly improve water quality.

There are <span style="color:#00806E">8,996 properties</span> in the watershed that are in a Special Flood Hazard Area and are adjacent to mangroves, salt marshes, oyster bars, and/or seagrasses, together worth over <span style="color:#00806E">\$7.19 billion</span>. The flood reduction benefits provided by these mangroves and wetlands total approx. <span style="color:#00806E">\$924 million</span> over a 30-year period for a flood that has a 1% chance of occurrence in a given year. Hillsborough County receives the greatest benefits from wetlands (<span style="color:#00806E">\$457 million</span>), followed by Pinellas County (<span style="color:#00806E">\$397 million</span>) and Manatee County (<span style="color:#00806E">\$70.59 million</span>).

</font>


### USING THIS PAGE

<font size="3">

This page summarizes the results of the different ecosystem service valuations for select habitats within the Tampa Bay watershed.

The <span style="color:#00806E">Summary</span> tab provides a map showing the habitats contributing to carbon sequestration and denitrification services. The map is interactive. Users can click on different habitats to view the total area of the habitat in the watershed and the total valuation of its sequestration and denitrification services per year. Some habitats only contribute to  one of these ecosystem services. 

In the <span style="color:#00806E">Carbon Sequestration</span> tab, select the desired scale (per acre or total for Tampa Bay) and type of carbon flow (sequestration or stock) from the dropdown lists to display graphs of the contributions of each habitat to carbon-related ecosystem services, including the quantity of carbon stored/sequestered and its associated valuation in dollars.

Like the previous tab, select the desired scale in the <span style="color:#00806E">Denitrification</span> tab to compare the denitrification services between habitats in the watershed.

The <span style="color:#00806E">Flood Protection</span> tab provides a comparison of two groups of habitats (mangroves and wetlands) within different counties in the watershed. Graphs display (1) the number of properties protected from flooding, (2) the total value of all properties in a flood zone adjacent to the habitat, and (3) the total flood protection benefits to those properties by different habitats in different counties. The graphs are interactive. Users can hover over the data to view the precise results for a given habitat.

<i>NOTE: The following habitats are combined to represent estuarine wetlands in the flood protection analysis: oyster bars, seagrasses, and saltwater marshes.</i>

</font>

Column {.tabset .tabset-fade data-width=650}
-----------------------------------------------------------------------

#### Ecosystem Services


### Summary (FIX)

```{r}
output$habitat_map <- renderLeaflet(habitat_map())

fillCol(flex = c(NA, 1),
        column(6,
               selectInput('habitat_selection', 'Select habitat:', selected = "Salt Marshes", choices = c("Freshwater Wetlands","Mangrove Forests", "Oyster Bars", "Pine Flatwoods", "Salt Marshes", "Seagrasses","Shrub and Brushland"))),
        leafletOutput('habitat_map')
)

```
<br>
<br>

```{r}
#map1 <- mapview(watershed, zcol = "Name", color = "black", lwd = 2, legend = FALSE, popup = FALSE)
#map1 + map2
#st_simplify
```



### Carbon Sequestration (READY)

```{r}
mainPanel(
  column(6,
         selectInput('yrselseas', 'Select scale:', selected = "Per Acre", choices = c("Per Acre", "Total in Tampa Bay"))),
  column(6,
         selectInput('yrselseas', 'Select flow:', selected = "Sequestration", choices = c("Sequestration", "Current Stock"))))
```
<br>
<br>
<br>

```{r}
# SCALE: Per-acre | FLOW: Sequestration

CarbonSeq_PerAcre1 <- ES_carbon %>%
  plot_ly(
    width = 900,
    height = 325,
    y = ~Habitat,
    x = ~Per.acre.Sequestration..tonnes.CO2.ac.yr.,
    type = "bar",
    orientation = "h",
    marker = list(color = c("#9C974A","#78B7C5","#5C4A42","#00806E","#004F7E","#F2AD00")),
    hoverinfo = "text",
    text = ~paste(Per.acre.Sequestration..tonnes.CO2.ac.yr., "tonnes CO2 per acre annually")) %>%
  layout(
    xaxis = list(title = "tonnes CO2/ac/yr"),
    yaxis = list(title = ""),
    hoverlabel = list(
      font = list(family = "Arial", size = 16, color = "white")))

CarbonSeq_PerAcre2 <- ES_carbon %>%
  plot_ly(
    width = 900,
    height = 325,
    y = ~Habitat,
    x = ~Per.acre.Sequestration.Value....ac.,
    type = "bar",
    orientation = "h",
    marker = list(color = c("#9C974A","#78B7C5","#5C4A42","#00806E","#004F7E","#F2AD00")),
    hoverinfo = "text",
    text = ~paste("$", prettyNum(round(Per.acre.Sequestration.Value....ac., digits = 0)), "per acre annually")) %>%
  layout(
    xaxis = list(title = "$/ac/yr"),
    yaxis = list(title = ""),
    hoverlabel = list(
      font = list(family = "Arial", size = 16, color = "white")))

CarbonSeq_PerAcre <- subplot(CarbonSeq_PerAcre1, CarbonSeq_PerAcre2, nrows = 1,
                          titleX = TRUE, titleY = FALSE, margin = 0.09) %>%
  layout(showlegend = FALSE,
         annotations = list(
           list(x = 0.05, y = 1.1, text = "Carbon Sequestration Rate", showarrow = F, xref='paper', yref='paper', font = list(size = 16)),
           list(x = 0.94, y = 1.1, text = "Value of Carbon Sequestered", showarrow = F, xref='paper', yref='paper', font = list(size = 16))))
CarbonSeq_PerAcre
```


```{r}
# SCALE: Per-acre | FLOW: Stock

CarbonStock_PerAcre1 <- ES_carbon %>%
  plot_ly(
    width = 900,
    height = 325,
    y = ~Habitat,
    x = ~Per.acre.Stock..tonnes.CO2.ac.,
    type = "bar",
    orientation = "h",
    marker = list(color = c("#9C974A","#78B7C5","#5C4A42","#00806E","#004F7E","#F2AD00")),
    hoverinfo = "text",
    text = ~paste(prettyNum(round(Per.acre.Stock..tonnes.CO2.ac., digits = 0)), "tonnes CO2 per acre")) %>%
  layout(
    xaxis = list(title = "tonnes CO2/ac"),
    yaxis = list(title = ""),
    hoverlabel = list(
      font = list(family = "Arial", size = 16, color = "white")))

CarbonStock_PerAcre2 <- ES_carbon %>%
  plot_ly(
    width = 900,
    height = 325,
    y = ~Habitat,
    x = ~Per.acre.Stock.Value....ac.,
    type = "bar",
    orientation = "h",
    marker = list(color = c("#9C974A","#78B7C5","#5C4A42","#00806E","#004F7E","#F2AD00")),
    hoverinfo = "text",
    text = ~paste("$", prettyNum(round(Per.acre.Stock.Value....ac., digits = 0), big.mark = ","), "per acre")) %>%
  layout(
    xaxis = list(title = "$/ac"),
    yaxis = list(title = ""),
    hoverlabel = list(
      font = list(family = "Arial", size = 16, color = "white")))

CarbonStock_PerAcre <- subplot(CarbonStock_PerAcre1, CarbonStock_PerAcre2, nrows = 1,
                             titleX = TRUE, titleY = FALSE, margin = 0.09) %>%
  layout(showlegend = FALSE,
         annotations = list(
           list(x = 0.05, y = 1.1, text = "Current Carbon Stock", showarrow = F, xref='paper', yref='paper', font = list(size = 16)),
           list(x = 0.94, y = 1.1, text = "Value of Current Carbon Stock", showarrow = F, xref='paper', yref='paper', font = list(size = 16))))
#CarbonStock_PerAcre
```

```{r}
# SCALE: Total | FLOW: Sequestration

CarbonSeq_Total1 <- ES_carbon %>%
  plot_ly(
    width = 900,
    height = 325,
    y = ~Habitat,
    x = ~Total.Sequestration..tonnes.CO2.yr.,
    type = "bar",
    orientation = "h",
    marker = list(color = c("#9C974A","#78B7C5","#5C4A42","#00806E","#004F7E","#F2AD00")),
    hoverinfo = "text",
    text = ~paste(prettyNum(round(Total.Sequestration..tonnes.CO2.yr., digits = 0), big.mark = ","), "tonnes CO2 annually")) %>%
  layout(
    xaxis = list(title = "tonnes CO2/yr"),
    yaxis = list(title = ""),
    hoverlabel = list(
      font = list(family = "Arial", size = 16, color = "white")))

CarbonSeq_Total2 <- ES_carbon %>%
  plot_ly(
    width = 900,
    height = 325,
    y = ~Habitat,
    x = ~Total.Sequestration.Value....,
    type = "bar",
    orientation = "h",
    marker = list(color = c("#9C974A","#78B7C5","#5C4A42","#00806E","#004F7E","#F2AD00")),
    hoverinfo = "text",
    text = ~paste("$", prettyNum(round(Total.Sequestration.Value...., digits = 0), big.mark = ","), "annually")) %>%
  layout(
    xaxis = list(title = "$/yr"),
    yaxis = list(title = ""),
    hoverlabel = list(
      font = list(family = "Arial", size = 16, color = "white")))

CarbonSeq_Total <- subplot(CarbonSeq_Total1, CarbonSeq_Total2, nrows = 1,
                             titleX = TRUE, titleY = FALSE, margin = 0.09) %>%
  layout(showlegend = FALSE,
         annotations = list(
           list(x = 0.05, y = 1.1, text = "Carbon Sequestration Rate", showarrow = F, xref='paper', yref='paper', font = list(size = 16)),
           list(x = 0.94, y = 1.1, text = "Value of Carbon Sequestered", showarrow = F, xref='paper', yref='paper', font = list(size = 16))))
#CarbonSeq_Total
```


```{r}
# SCALE: Total | FLOW: Stock

CarbonStock_Total1 <- ES_carbon %>%
  plot_ly(
    width = 900,
    height = 325,
    y = ~Habitat,
    x = ~Total.Stock..tonnes.CO2.,
    type = "bar",
    orientation = "h",
    marker = list(color = c("#9C974A","#78B7C5","#5C4A42","#00806E","#004F7E","#F2AD00")),
    hoverinfo = "text",
    text = ~paste(prettyNum(round(Total.Stock..tonnes.CO2., digits = 0), big.mark = ","), "tonnes CO2")) %>%
  layout(
    xaxis = list(title = "tonnes CO2"),
    yaxis = list(title = ""),
    hoverlabel = list(
      font = list(family = "Arial", size = 16, color = "white")))

CarbonStock_Total2 <- ES_carbon %>%
  plot_ly(
    width = 900,
    height = 325,
    y = ~Habitat,
    x = ~Total.Stock.Value....,
    type = "bar",
    orientation = "h",
    marker = list(color = c("#9C974A","#78B7C5","#5C4A42","#00806E","#004F7E","#F2AD00")),
    hoverinfo = "text",
    text = ~paste("$",prettyNum(round(Total.Stock.Value...., digits = 0), big.mark = ","))) %>%
  layout(
    xaxis = list(title = "$"),
    yaxis = list(title = ""),
    hoverlabel = list(
      font = list(family = "Arial", size = 16, color = "white")))

CarbonStock_Total <- subplot(CarbonStock_Total1, CarbonStock_Total2, nrows = 1,
                               titleX = TRUE, titleY = FALSE, margin = 0.09) %>%
  layout(showlegend = FALSE,
         annotations = list(
           list(x = 0.05, y = 1.1, text = "Current Carbon Stock", showarrow = F, xref='paper', yref='paper', font = list(size = 16)),
           list(x = 0.94, y = 1.1, text = "Value of Current Carbon Stock", showarrow = F, xref='paper', yref='paper', font = list(size = 16))))
#CarbonStock_Total
```



### Denitrification (READY)


```{r}
mainPanel(
  column(6,
         selectInput('yrselseas', 'Select scale:', selected = "Per Acre", choices = c("Per Acre", "Total in Tampa Bay"))))
```
<br>
<br>
<br>

```{r}
# SCALE: Per-acre

Denitrification_PerAcre1 <- ES_denitrification %>%
  plot_ly(
    width = 900,
    height = 325,
    y = ~Habitat,
    x = ~Per.acre.Denitrification..kg.N.ac.yr.,
    type = "bar",
    orientation = "h",
    marker = list(color = c("#9C974A","#78B7C5","#962D14","#00806E","#004F7E")),
    hoverinfo = "text",
    text = ~paste(Per.acre.Denitrification..kg.N.ac.yr., "kg N per acre annually")) %>%
  layout(
    xaxis = list(title = "kg N/ac/yr"),
    yaxis = list(title = ""),
    hoverlabel = list(
      font = list(family = "Arial", size = 16, color = "white")))

Denitrification_PerAcre2 <- ES_denitrification %>%
  plot_ly(
    width = 900,
    height = 325,
    y = ~Habitat,
    x = ~Per.acre.Denitrification.Value....ac.,
    type = "bar",
    orientation = "h",
    marker = list(color = c("#9C974A","#78B7C5","#962D14","#00806E","#004F7E")),
    hoverinfo = "text",
    text = ~paste("$", prettyNum(round(Per.acre.Denitrification.Value....ac., digits = 0), big.mark = ","), "per acre annually")) %>%
  layout(
    xaxis = list(title = "$/ac/yr"),
    yaxis = list(title = ""),
    hoverlabel = list(
      font = list(family = "Arial", size = 16, color = "white")))

Denitrification_PerAcre <- subplot(Denitrification_PerAcre1, Denitrification_PerAcre2, nrows = 1,
                             titleX = TRUE, titleY = FALSE, margin = 0.09) %>%
  layout(showlegend = FALSE,
         annotations = list(
           list(x = 0.09, y = 1.1, text = "Denitrification Rate", showarrow = F, xref='paper', yref='paper', font = list(size = 16)),
           list(x = 0.96, y = 1.1, text = "Value of Denitrification Services", showarrow = F, xref='paper', yref='paper', font = list(size = 16))))
Denitrification_PerAcre
```


```{r}
# SCALE: Total

Denitrification_Total1 <- ES_denitrification %>%
  plot_ly(
    width = 900,
    height = 325,
    y = ~Habitat,
    x = ~Total.Denitrification..kg.N.yr.,
    type = "bar",
    orientation = "h",
    marker = list(color = c("#9C974A","#78B7C5","#962D14","#00806E","#004F7E")),
    hoverinfo = "text",
    text = ~paste(prettyNum(round(Total.Denitrification..kg.N.yr., digits = 0), big.mark = ","), "kg N annually")) %>%
  layout(
    xaxis = list(title = "kg N/yr"),
    yaxis = list(title = ""),
    hoverlabel = list(
      font = list(family = "Arial", size = 16, color = "white")))

Denitrification_Total2 <- ES_denitrification %>%
  plot_ly(
    width = 900,
    height = 325,
    y = ~Habitat,
    x = ~Total.Denitrification.Value....,
    type = "bar",
    orientation = "h",
    marker = list(color = c("#9C974A","#78B7C5","#962D14","#00806E","#004F7E")),
    hoverinfo = "text",
    text = ~paste("$",prettyNum(round(Total.Denitrification.Value...., digits = 0), big.mark = ","), "annually")) %>%
  layout(
    xaxis = list(title = "$/yr"),
    yaxis = list(title = ""),
    hoverlabel = list(
      font = list(family = "Arial", size = 16, color = "white")))

Denitrification_Total <- subplot(Denitrification_Total1, Denitrification_Total2, nrows = 1,
                                   titleX = TRUE, titleY = FALSE, margin = 0.09) %>%
  layout(showlegend = FALSE,
         annotations = list(
           list(x = 0.09, y = 1.1, text = "Denitrification Rate", showarrow = F, xref='paper', yref='paper', font = list(size = 16)),
           list(x = 0.96, y = 1.1, text = "Value of Denitrification Services", showarrow = F, xref='paper', yref='paper', font = list(size = 16))))
#Denitrification_Total
```


### Flood Protection (DONE)

<br>
```{r}

Flood_Parcels <- ES_flood %>%
  plot_ly(
    width = 900,
    height = 400,
    x = ~County,
    y = ~Number.of.Protected.Parcels,
    type = "bar",
    #marker = list(color = c("#00806E","#004F7E")),
    transforms = list(list(type = "groupby", groups = ~Habitat, styles = list(
      list(target = "Wetlands", value = list(marker = list(color = "#004F7E"))),
      list(target = "Mangroves", value = list(marker = list(color = "#9C974A"))),
      list(target = "All habitats", value = list(marker = list(color = "#000000")))
    ))),
    hoverinfo = "text",
    text = paste(ES_flood$Habitat, ":<br>",
                 prettyNum(round(ES_flood$Number.of.Protected.Parcels, digits = 0), big.mark = ","), 
                 "parcels protected")) %>%
  layout(
    #title = "Properties Included in Model",
    yaxis = list(title = "Number of parcels"),
    xaxis = list(title = "County"),
    hoverlabel = list(
      font = list(family = "Arial", size = 16, color = "white")))

Flood_Values <- ES_flood %>%
  plot_ly(
    width = 900,
    height = 400,
    x = ~County,
    y = ~Property.Values.in.Flood.Zone,
    type = "bar",
    #marker = list(color = c("#00806E","#004F7E")),
    transforms = list(list(type = "groupby", groups = ~Habitat, styles = list(
      list(target = "Wetlands", value = list(marker = list(color = "#004F7E"))),
      list(target = "Mangroves", value = list(marker = list(color = "#9C974A"))),
      list(target = "All habitats", value = list(marker = list(color = "#000000")))
    ))),
    hoverinfo = "text",
    text = paste(ES_flood$Habitat, ":<br>",
                 ES_flood$Values, "total property value")) %>%
  layout(
    #title = "Properties Included in Model",
    yaxis = list(title = "Property values ($)"),
    xaxis = list(title = "County"),
    hoverlabel = list(
      font = list(family = "Arial", size = 16, color = "white")))

Flood_Benefits <- ES_flood %>%
  plot_ly(
    width = 900,
    height = 400,
    x = ~County,
    y = ~Total.Flood.Protection.Benefits,
    type = "bar",
    #marker = list(color = c("#00806E","#004F7E")),
    transforms = list(list(type = "groupby", groups = ~Habitat, styles = list(
      list(target = "Wetlands", value = list(marker = list(color = "#004F7E"))),
      list(target = "Mangroves", value = list(marker = list(color = "#9C974A"))),
      list(target = "All habitats", value = list(marker = list(color = "#000000")))
    ))),
    hoverinfo = "text",
    text = paste(ES_flood$Habitat, ":<br>",
                 ES_flood$Benefits, "in benefits")) %>%
  layout(
    #title = "Properties Included in Model",
    yaxis = list(title = "Total benefits ($)"),
    xaxis = list(title = "County"),
    hoverlabel = list(
      font = list(family = "Arial", size = 16, color = "white")))

FloodProtection <- subplot(Flood_Parcels, Flood_Values, Flood_Benefits, nrows = 1,
                          titleY = TRUE, titleX = TRUE, margin = 0.06) %>%
  layout(showlegend = FALSE,
         annotations = list(
           list(x = 0.04, y = 1.09, text = "Protected Properties", showarrow = F, xref='paper', yref='paper', font = list(size = 16)),
           list(x = 0.5, y = 1.09, text = "Property Values in Adjacent Flood Zone", showarrow = F, xref='paper', yref='paper', font = list(size = 16)),
           list(x = 0.99, y = 1.09, text = "Flood Protection Benefit", showarrow = F, xref='paper', yref='paper', font = list(size = 16))))
FloodProtection
```


Economic Impacts of Industry Sectors {data-navmenu="Methods"}
===========================================================

Column {data-width=700}
-----------------------------------------------------------------------

<div class = "row">
<div class = "col-md-2"></div>
<div class = "col-md-10">

#### Economic Impacts of Industry Sectors

Proximity to valued resources— to amenities, such as parks and waterfront views— generates price premiums for adjacent properties, just as the value of a home rises with the number of bedrooms or total floor space. Unlike commercial applications of natural resources, however, the premium of proximity to amenities can only change hands, its value is inherent in its location. Unbundling the amenity value added to a property from its physical characteristics is generally accomplished through two kinds of valuation methods: stated preference (surveys) and revealed preference methods.25 Since survey research was outside of the scope of this analysis, the revealed preference method of hedonic pricing was used to value amenities provided by Tampa Bay to nearby properties. Hedonic pricing approaches use statistical methods to parse the relative contribution of an amenity to the total value of an asset by isolating the effect of different elements of a property’s market value. 

This report examined property appraiser data for 61,287 single-family homes within the watershed boundaries, of which 10,484 had been sold within the last two years. Through an iterative process, the project team determined which of more than one hundred different elements of a property had a statistically significant effect on its value. These include obvious attributes that add value, such as land, square footage, the presence of special features, and the age of the structure, all of which were included and thus ‘controlled for’ in the analysis. 

Ultimately, four regression models were created using two different regression methods to explore the added amenity value afforded by Tampa Bay to nearby properties. The analysis employed a quarter-mile buffer around the bay and its four major tributaries— Hillsborough River, Alafia River, Little Manatee River, and Manatee River— as a dividing line between property groups. All properties were either ‘close to the coast’ (within a quarter-mile) or ‘far from the coast’ (beyond a quarter-mile), and this element was added as a variable to each property. A more detailed accounting of these methods, and all four of these models, can be found in the report’s appendix (see Hedonic Analysis of Property Values). 

<br>

##### Table 22. Summary of property value regression models.

```{r, fig.align='left', out.width='80%'}
knitr::include_graphics('img/regressions.PNG')
```

<br>

</div>
<div class = "col-md-2"></div>
</div>


Column {data-width=325}
-----------------------------------------------------------------------

<div class = "row">
<div class = "col-md-2"></div>
<div class = "col-md-9">

<br>
```{r, fig.align='left', out.width='80%'}
knitr::include_graphics('img/report.PNG')
```

<b>[Download the full report](https://github.com/tbep-tech/tbev-dash)</b>

</div>
<div class = "col-md-2"></div>
</div>



Property Value Amenity Impacts {data-navmenu="Methods"}
===========================================================

Column {data-width=700}
-----------------------------------------------------------------------

<div class = "row">
<div class = "col-md-2"></div>
<div class = "col-md-10">

#### Property Value Amenity Impacts

Proximity to valued resources— to amenities, such as parks and waterfront views— generates price premiums for adjacent properties, just as the value of a home rises with the number of bedrooms or total floor space. Unlike commercial applications of natural resources, however, the premium of proximity to amenities can only change hands, its value is inherent in its location. Unbundling the amenity value added to a property from its physical characteristics is generally accomplished through two kinds of valuation methods: stated preference (surveys) and revealed preference methods.25 Since survey research was outside of the scope of this analysis, the revealed preference method of hedonic pricing was used to value amenities provided by Tampa Bay to nearby properties. Hedonic pricing approaches use statistical methods to parse the relative contribution of an amenity to the total value of an asset by isolating the effect of different elements of a property’s market value. 

This report examined property appraiser data for 61,287 single-family homes within the watershed boundaries, of which 10,484 had been sold within the last two years. Through an iterative process, the project team determined which of more than one hundred different elements of a property had a statistically significant effect on its value. These include obvious attributes that add value, such as land, square footage, the presence of special features, and the age of the structure, all of which were included and thus ‘controlled for’ in the analysis. 

Ultimately, four regression models were created using two different regression methods to explore the added amenity value afforded by Tampa Bay to nearby properties. The analysis employed a quarter-mile buffer around the bay and its four major tributaries— Hillsborough River, Alafia River, Little Manatee River, and Manatee River— as a dividing line between property groups. All properties were either ‘close to the coast’ (within a quarter-mile) or ‘far from the coast’ (beyond a quarter-mile), and this element was added as a variable to each property. A more detailed accounting of these methods, and all four of these models, can be found in the report’s appendix (see Hedonic Analysis of Property Values). 

<br>

<b>Table 22. Summary of property value regression models.</b>

```{r, fig.align='left', out.width='80%'}
knitr::include_graphics('img/regressions.PNG')
```

<br>

</div>
<div class = "col-md-2"></div>
</div>


Column {data-width=325}
-----------------------------------------------------------------------

<div class = "row">
<div class = "col-md-2"></div>
<div class = "col-md-9">

<br>
```{r, fig.align='left', out.width='80%'}
knitr::include_graphics('img/report.PNG')
```

<b>[Download the full report](https://github.com/tbep-tech/tbev-dash)</b>

</div>
<div class = "col-md-2"></div>
</div>



Ecosystem Services {data-navmenu="Methods"}
===========================================================

Column {data-width=700}
-----------------------------------------------------------------------

<div class = "row">
<div class = "col-md-2"></div>
<div class = "col-md-10">

#### Ecosystem Services

The Tampa Bay estuary is comprised of diverse saltwater and freshwater ecosystems, such as seagrasses, oyster bars, mangrove forests, salt marshes, pine flatwoods, freshwater wetlands, and shrub and brushland habitat. When healthy, these ecosystems produce numerous direct and indirect benefits to humans, which are collectively referred to as ecosystem services. This study quantifies values associated with carbon sequestration, flood protection, and denitrification services provided by relevant habitats around the Tampa Bay estuary. The results are simplified estimates designed to raise awareness of the benefits afforded by ecosystem services and a prelude to future analyses and planning using more complete information and site-specific data. 

The services provided by ecosystems have not traditionally been incorporated into valuations, effectively assigning them an implicit value of zero. One way to make these goods and services more visible is by demonstrating society’s willingness to pay for the benefits they provide. Some services, like the supply of fish and lumber, produce value through their direct use and can be found in traditional markets, whereas other ecosystem services, like flood protection and pollination, are indirectly enjoyed by humans, and therefore not captured in existing markets. Those services that are directly extracted and consumed can be valued with their market price, but services that provide indirect benefits are more difficult to assign a monetary value, so they require proxy values. As a result, different methods are needed for a more comprehensive valuation of estuary resources. 

Revealed preference methods were used in this study to value three regulating services: flood protection, water purification via denitrification, and climate regulation via carbon sequestration. The avoided damage costs method is used to find the value of flood protection services provided by estuary habitats through their ability to buffer storm surge and reduce severe flooding, which equates the value of these services to the costs of damages that would occur if the services were unavailable. In some cases, services can be valued based on estimated or observed market prices for mitigating damages and replacement services, including emissions trading and nutrient offset schemes. This method is used for the valuation of carbon sequestration and denitrification services provided by estuary habitats. 

It is important to keep in mind that the results of this section should not be interpreted as the total value of natural resources in the Tampa Bay watershed since only a subset of ecosystem services were valued. Other benefits that were not included, but that should be explored in future research include: non-market value of recreational fishing trips, provision of habitat, air quality maintenance, and water and nutrient cycling.

<br>

#### 1. Carbon Sequestration

This study estimated the current amount and economic value of carbon sequestration services provided by mangrove forests, salt marshes, pine flatwoods, seagrasses, freshwater wetlands, and shrub and brushland habitats in the Tampa Bay watershed. Carbon services were assessed using habitat extent, as well as annual carbon sequestration rates from peer-reviewed literature, namely the Tampa Bay Blue Carbon Assessment. The monetary values of carbon sequestration were determined using 2020 estimates of the federal Interagency Working Group on Social Cost of Greenhouse Gases, which were adjusted for inflation. A more detailed accounting of these methods can be found in the report’s appendix (see Carbon Sequestration).

<br>

<b>Table 26. Conversions of carbon sequestration and stock rates.</b>

```{r, fig.align='left', out.width='80%'}
knitr::include_graphics('img/cconversions.PNG')
```

<br>


#### 2. Denitrification

This analysis quantified an approximate value of denitrification services provided by mangrove forests, salt marshes, oyster bars, seagrasses, and freshwater wetlands in the Tampa Bay watershed. Estimating the market price of the current denitrification services and water quality regulation provided by bay habitats helps demonstrate their significance to the region and what is at stake, or could be gained, by actions or inactions that address nutrient loading. Nutrient mitigation programs offer a useful proxy for the replacement cost of substitute services that provide the same nutrient removal benefits.

To assess the value-added from denitrification services, this study used the market rate for nutrient offset credits from the North Carolina Nutrient Offset Credit Program. North Carolina’s voluntary offset program is used by private and public sector entities to address their nutrient loading requirements. The offset rates reflect the costs associated with designing and implementing substitute wetland restoration projects to mitigate equivalent nutrient inputs entering the watershed. The 2019 average offset rate was combined with estimates of areal extent and denitrification rates for each habitat in the watershed to estimate yearly values. A more detailed description of the methods is provided in the appendix (see Denitrification)

<br>

<b>Table 32. Denitrification rates of select habitats in Tampa Bay.</b>

```{r, fig.align='left', out.width='80%'}
knitr::include_graphics('img/nrates.PNG')
```

<br>

#### 3. Flood Protection

To value the flood protection services of wetland habitats in the Tampa Bay estuary, this study used an avoided damage method that estimates the predicted damages to real property from surge flooding that might be reduced by the presence of adjacent estuarine wetlands. More specifically, the protection services were determined by estimating the reduction in likely flood damages to coastal properties from a 100-year flood attributable to neighboring wetlands, including salt marshes, oyster bars, and seagrasses, as well as mangrove forests. These avoided costs were calculated over a 30-year period, matching the average length of a residential mortgage, using a damage function formula derived from Restore America’s Estuaries’ 2021 Economic Value of America’s Estuaries report. The net present value was approximated using publicly available data for the flood extent and severity, wetland locations, economic values at risk, flood damages, and wetland effects on damages. A more detailed accounting of the methods can be found in the appendix (see Flood Protection). The resulting values are for damages to properties exposed to flooding and do not include impacts to business sales, employment, or public health, thus the estimated damages are likely lower than what can be expected.

<br>
<b>Map of habitats and protected properties in the watershed.</b>
```{r}

parcelmap <- parcels %>%
  filter(FloodZone != "No intersect project Flood Zones") %>%
  mapview(zcol = "FloodZone", col.regions = c("#D69C4E","#5C4A42"), alpha.regions = 1.0, layer.name = "Protected Parcels", lwd = 0,
                     popup = popupTable(parcels,
                                        zcol = "Habitat",
                                        feature.id = FALSE,
                                        row.numbers = FALSE))

habitatmaps <- mapview(wetlands, col.regions = "#004F7E", lwd = 0, alpha.regions = 1.0, layer.name = "Wetlands", label = "FLUCCSDESC", popup = FALSE) +
  mapview(mangroves, col.regions = "#9C974A", lwd = 0, alpha.regions = 1.0, layer.name = "Mangroves", label = "FLUCCSDESC", popup = FALSE)

#sync(habitatmaps, parcelmap)
```

<br>
<br>

</div>
<div class = "col-md-2"></div>
</div>


Column {data-width=325}
-----------------------------------------------------------------------

<div class = "row">
<div class = "col-md-2"></div>
<div class = "col-md-9">

<br>
```{r, fig.align='left', out.width='80%'}
knitr::include_graphics('img/report.PNG')
```

<b>[Download the full report](https://github.com/tbep-tech/tbev-dash)</b>

</div>
<div class = "col-md-2"></div>
</div>




<i>Download Data</i> {data-navmenu="Methods"}
===========================================================

Column {data-width=700}
-----------------------------------------------------------------------

<div class = "row">
<div class = "col-md-2"></div>
<div class = "col-md-10">

#### Download the Data

Click the buttons below to download the data from the Economic Valuation of Tampa Bay. You can download all original datasets from the report or selectively download data for the three different analyses. This data includes original raw data, formula workbooks, tables from the report, and R code (where applicable) compiled by the authors of the report. Any questions related to the structure or content of the datasets should be directed to [Alana Todd](mailto:alana@tbrpc.org).

<i>
```{r}
column(12, 
       column(6, "All original datasets:"))
column(12, 
       column(6, downloadButtonRmd('TBEVdata', 'Download')))
```

```{r, fig.align='center', out.width='5%'}
knitr::include_graphics('img/spacer.PNG')
```

```{r}
column(12, 
       column(4, "Economic impact data:"), 
       column(4, "Property value data:"), 
       column(4, "Ecosystem service data:")
)
column(12, 
       column(4, downloadButtonRmd('EIdata', 'Download')), 
       column(4, downloadButtonRmd('PVdata', 'Download')), 
       column(4, downloadButtonRmd('ESdata', 'Download'))
)
```
</i>
<br>

```{r, fig.align='center', out.width='5%'}
knitr::include_graphics('img/spacer.PNG')
```


The original data has been restructured into high-level summaries for display in this dashboard. To access the summarized datasets underlying the different the pages of this dashboard, visit the Tampa Bay Economic Valuation Dashboard Github repository [here](https://github.com/tbep-tech/tbev-dash). You can download the R source code for the dashboard, including the datasets used to display the results. Any questions related to the R code or datasets in the repository should be directed to [Dr. Blake Simmons](mailto:bsimmons@tbep.org). 
```{r, fig.align='center', out.width='5%'}
knitr::include_graphics('img/spacer.PNG')
```

#### Citation

<font size="3">By downloading the data, you agree not to redistribute or republish all or part of the data without citation and written permission by the authors of the report. Any use of the primary data created by the report must appropriately cite the report.   

Recommended citation:

<i>Todd, A., Walsh, H., & Neville, J. (2023). Economic valuation of Tampa Bay: Economic impacts of industry sectors, amenities, and ecological services. Tampa Bay Regional Planning Council.</i></font> 

<br>

</div>
<div class = "col-md-2"></div>
</div>


Column {data-width=325}
-----------------------------------------------------------------------

<div class = "row">
<div class = "col-md-2"></div>
<div class = "col-md-9">

<br>
```{r, fig.align='left', out.width='80%'}
knitr::include_graphics('img/report.PNG')
```

<b>[Download the full report](https://github.com/tbep-tech/tbev-dash)</b>

```{r, fig.align='center', out.width='5%'}
knitr::include_graphics('img/spacer.PNG')
```

```{r, fig.align='center', out.width='5%'}
knitr::include_graphics('img/spacer.PNG')
```

```{r, fig.align='left', out.width='80%'}
knitr::include_graphics('img/tbrpclogo.PNG')
```

```{r, fig.align='left', out.width='80%'}
knitr::include_graphics('img/tbeptberflogo.PNG')
```

</div>
<div class = "col-md-2"></div>
</div>
